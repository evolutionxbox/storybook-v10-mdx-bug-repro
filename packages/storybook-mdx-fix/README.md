# @repo/storybook-mdx-fix

Workaround Vite plugin for Storybook v10 MDX compiler file:// URL bug.

## Problem

In Storybook v10.1.11, when using a Yarn workspaces + Turborepo monorepo with `.storybook/` in a subdirectory (not at root), the MDX compiler generates file:// URLs instead of module specifiers:

```javascript
// Generated by Storybook v10 MDX compiler (BROKEN):
import {useMDXComponents} from "file:///absolute/path/to/node_modules/@storybook/addon-docs/dist/mdx-react-shim.js";
```

This causes Vite's import analysis to fail with:
```
Failed to resolve import "file:///..." from "Introduction.mdx"
```

## Solution

This plugin intercepts MDX files and transforms file:// URLs back to proper module specifiers:

```javascript
// After plugin transformation (WORKING):
import {useMDXComponents} from "@storybook/addon-docs/mdx-react-shim";
```

## Usage

In your `.storybook/main.ts`:

```typescript
import type { StorybookConfig } from '@storybook/react-vite';
import { fixStorybookMdxImports } from '@repo/storybook-mdx-fix';

const config: StorybookConfig = {
  // ... other config
  async viteFinal(config) {
    config.plugins = config.plugins || [];
    config.plugins.push(fixStorybookMdxImports());
    return config;
  },
};

export default config;
```

## Bug Report

This is a workaround for a bug in Storybook v10.1.11. See the filed bug report: [Link to be added]

## Related Issues

- #33362 - MDX resolution in monorepos
- #33287 - Path resolution when .storybook not at root
- #33118 - MDX doc blocks import issues
- #32604 - file:// URL resolution with MDX
